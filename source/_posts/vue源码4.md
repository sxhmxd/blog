---
title: Vue.js 源码解读, 模板编译
categories: [Vue.js 源码解读, 模板编译]
---

## 什么是模板编译

`Vue` 会把用户在`<template></template>`标签中写的类似于原生 HTML 的内容进行编译，把原生 HTML 的内容找出来，再把非原生 HTML 找出来，经过一系列的逻辑处理生成渲染函数，也就是 render 函数，而 render 函数会将模板内容生成对应的 VNode，而 VNode 再经过前几篇文章介绍的 patch 过程从而得到将要渲染的视图中的 VNode，最后根据 VNode 创建真实的 DOM 节点并插入到视图中， 最终完成视图的渲染更新。
而把用户在<template></template>标签中写的类似于原生 HTML 的内容进行编译，把原生 HTML 的内容找出来，再把非原生 HTML 找出来，经过一系列的逻辑处理生成渲染函数，也就是 render 函数的这一段过程称之为模板编译过程。

## 整体渲染流程

渲染流程，就是把用户写的类似于原生 HTML 的模板经过一系列处理最终反应到视图中称之为整个渲染流程。

![渲染流程](https://vue-js.com/learn-vue/assets/img/1.f0570125.png)

## 模板编译内部流程

### 抽象语法树 AST

抽象语法树，在计算机科学中，抽象语法树（AbstractSyntaxTree，AST），或简称语法树（Syntax tree），是源代码语法结构的一种抽象表示。它以树状的形式表现编程语言的语法结构，树上的每个节点都表示源代码中的一种结构。之所以说语法是“抽象”的，是因为这里的语法并不会表示出真实语法中出现的每个细节。

### 流程

分为三个阶段:

- 模板解析阶段:将一堆模板字符串用正则等方式解析成抽象语法树 AST
- 优化阶段: 遍历 AST ,找出其中的静态节点, 并打上标记;
- 代码生成阶段：将 AST 转换成渲染函数;

![模板内部流程图](https://vue-js.com/learn-vue/assets/img/3.15d9566b.png)
