---
title: [web 代码编辑器]
categories: []
---

## web 代码编辑器

```
<template>
  <div id="yanzi-monaco-editor" :style="settings.style">
    <div class="topTabs" :class="{ 'topTabs-dark': theme === 'vs-dark' }">
      <el-tabs
        v-model="currentModelName"
        type="card"
        @tab-remove="removeTab"
        @tab-click="activeTab"
      >
        <el-tab-pane
          :closable="item.closable"
          v-for="item in modelList"
          :key="item.name"
          :label="item.title"
          :name="item.name"
        >
          <template>
            <span slot="reference">{{ item.content }}</span>
          </template>
        </el-tab-pane>
      </el-tabs>
    </div>

    <!-- 工具条 -->
    <div
      class="editorTools"
      :class="{
        editorToolsFullPage: fullPage,
        'editorTools-dark': theme === 'vs-dark',
      }"
    >
      <i
        @click="changeEditType('1')"
        :class="{ toolItemActive: editType == '1' }"
        class="toolItem iconfont iconfenlan"
      ></i>
      <i
        @click="changeEditType('2')"
        :class="{ toolItemActive: editType == '2' }"
        class="toolItem iconfont icondaima"
      ></i>
      <i
        @click="changeEditType('3')"
        :class="{ toolItemActive: editType == '3' }"
        class="toolItem iconfont iconkanfangxuanfang"
      ></i>
      <el-popover placement="bottom" title="" trigger="hover">
        <el-button-group>
          <el-button @click="reset('')" size="mini" plain>清空</el-button>
          <el-button @click="reset('vue')" size="mini" plain>Vue</el-button>
          <el-button @click="reset('html')" size="mini" plain>HTML</el-button>
        </el-button-group>
        <i class="toolItem iconfont iconreset" slot="reference"></i>
      </el-popover>

      <el-popover placement="bottom-start" title="" width="200" trigger="hover">
        <div class="storageBox">
          <h3>js库</h3>
          <el-button
            size="mini"
            type="text"
            @click="
              insertText('https://code.xzlovecyy.com/files/js/vue.min.js')
            "
            >Vue</el-button
          >
          <el-button
            size="mini"
            type="text"
            @click="
              insertText(
                'https://code.xzlovecyy.com/files/element-ui/lib/index.js'
              )
            "
            >Element UI</el-button
          >
          <el-button
            size="mini"
            type="text"
            @click="
              insertText('https://code.xzlovecyy.com/files/js/jquery.min.js')
            "
            >jQuery</el-button
          >
          <el-button
            size="mini"
            type="text"
            @click="
              insertText('https://code.xzlovecyy.com/files/js/echarts.min.js')
            "
            >Echarts</el-button
          >
          <el-button
            size="mini"
            type="text"
            @click="
              insertText('https://code.xzlovecyy.com/files/js/axios.min.js')
            "
            >axios</el-button
          >
          <el-button
            size="mini"
            type="text"
            @click="
              insertText('https://code.xzlovecyy.com/files/layui/layui.all.js')
            "
            >Layui</el-button
          >
          <el-button
            size="mini"
            type="text"
            @click="
              insertText('https://code.xzlovecyy.com/files/js/highlight.min.js')
            "
            >highlight</el-button
          >
          <h3>css库</h3>
          <el-button
            size="mini"
            type="text"
            @click="
              insertText(
                'https://code.xzlovecyy.com/files/element-ui/lib/theme-chalk/index.css'
              )
            "
            >Element UI</el-button
          >
          <el-button
            size="mini"
            type="text"
            @click="
              insertText('https://code.xzlovecyy.com/files/layui/css/layui.css')
            "
            >Layui</el-button
          >
          <el-button
            size="mini"
            type="text"
            @click="
              insertText(
                'https://code.xzlovecyy.com/files/css/bootstrap.min.css'
              )
            "
            >Bootstrap</el-button
          >
        </div>
        <i class="toolItem iconfont iconicon-store" slot="reference"></i>
      </el-popover>
      <i
        @click="changeTheme('vs-dark')"
        v-if="theme == 'vs'"
        class="toolItem iconfont iconyejianmoshishenyemoshiyueliang"
      ></i>
      <i
        @click="changeTheme('vs')"
        v-else
        class="toolItem iconfont iconday"
      ></i>
      <i
        @click="changeFullPage()"
        v-if="fullPage"
        class="toolItem iconfont iconsuoxiao"
      ></i>
      <i
        @click="changeFullPage()"
        v-else
        class="toolItem iconfont iconfullscreen"
      ></i>
      <i
        @click="runingCode()"
        v-if="isRun"
        :class="{ rotate: isRun }"
        class="toolItem iconfont iconyunxingzhong"
        style="color: #67c23a !important; background: transparent !important"
      ></i>
      <i
        @click="runingCode()"
        v-else
        class="toolItem iconfont icontingzhi"
        style="color: #f56c6c !important; background: transparent !important"
      ></i>
    </div>

    <div class="eidtorContent" :class="{ eidtorContentFullPage: fullPage }">
      <div
        class="monacoEditor"
        id="monaco"
        ref="monaco"
        :style="setEditorStyle()"
      ></div>
      <iframe
        class="viewIframe"
        id="viewIframe"
        ref="viewIframe"
        :style="setViewStyle()"
      ></iframe>
    </div>

    <el-dialog
      title="选择语言"
      :visible.sync="showSelectMode"
      width="280px"
      custom-class="selectModelDialog"
    >
      <el-radio-group v-model="mode" @change="selectModeRadio">
        <el-radio-button type="primary" label="html">html</el-radio-button>
        <el-radio-button label="javascript">javascript</el-radio-button>
        <el-radio-button label="css">css</el-radio-button>
      </el-radio-group>
    </el-dialog>
  </div>
</template>

<script>
/* eslint-disable */
<!-- import cache from '../utils/cache'
import toast from '../utils/tips'
import templateJS from '../utils/template' -->
/* eslint-disable */
import * as monaco from 'monaco-editor/esm/vs/editor/editor.main.js'
import { emmetHTML } from 'emmet-monaco-es'
import Vue from 'vue'
import ElementUI from 'element-ui'
import 'element-ui/lib/theme-chalk/index.css'
Vue.use(ElementUI)
export default {
  name: 'yanzi-monaco-editor',
  components: {},
  props: {
    settings: {
      type: Object,
      default: function () {
        return {
          style: {
            width: '100%',
            height: '100%',
          },
        }
      },
    },
  },
  data() {
    return {
      fullPage: false, // 是否全屏
      editType: '1', // 编辑模式， 【1 = 二栏边写边看、2 = 一栏编辑、 3 = 一栏预览】
      showSelectMode: false, // 添加model前，选择语言dialog
      mode: '', // 当前选中的 语言
      dispose: null, // 编辑器销毁方法
      theme: 'vs-dark', // 编辑器主题 vs, hc-black, or vs-dark
      myEditor: {}, // 初始化编辑器对象
      currentModelName: '', // 当前选中 tab model 的名称用于切换编辑器的model
      // 顶部的 tabs ,永远都会保留 + 这个 tab
      modelList: [
        {
          title: '+',
          name: '+',
        },
      ],
      isRun: false, // 是否实时运行
    }
  },
  methods: {
    // 运行代码
    runingCode() {
      this.isRun = !this.isRun
      cache.set('isRun', this.isRun)
      if (this.isRun) {
        this.showView()
      }
    },
    // 重置编辑器内容
    reset(type) {
      let model = this.myEditor.getModel()
      console.log(model)
      if (type == 'vue') {
        this.myEditor.setValue(templateJS.vue)
      } else if (type === 'html') {
        this.myEditor.setValue(templateJS.html)
      } else {
        this.myEditor.setValue('')
      }
    },
    // 切换全屏
    changeFullPage() {
      this.fullPage = !this.fullPage
      this.myEditor.layout()
    },
    // 切换编辑方式
    changeEditType(editType) {
      this.editType = editType
      this.myEditor.layout()
    },
    changeTheme(theme) {
      // 切换主题
      this.theme = theme
      console.log(theme)
      monaco.editor.setTheme(theme)
      localStorage.setItem('theme', theme)
    },
    // 复制内容到剪贴板
    insertText(content) {
      var line = this.myEditor.getPosition()
      var range = new monaco.Range(line.lineNumber, 1, line.lineNumber, 1)
      let suffix = content.substring(content.lastIndexOf('.') + 1)
      var id = { major: 1, minor: 1 }
      /* eslint-disable */
      var text =
        suffix == 'js'
          ? `\t<script src="${content}"><\/script>`
          : `\t<link rel="stylesheet" href="${content}"/>`
      /* eslint-disable */
      var op = {
        identifier: id,
        range: range,
        text: text,
        forceMoveMarkers: true,
      }
      this.myEditor.executeEdits('my-source', [op])
      // this.myEditor.insertText(content);
    },
    // 选中 tab
    activeTab(e) {
      // 点击不能关闭的，即是添加操作
      if (!e.closable) {
        this.openSelectMode()
        return
      }
      let model = this.getModelByName(e.name)
      this.changeEditorModel(model)
    },
    // 切换 编辑器 model
    changeEditorModel(model) {
      this.dispose && this.dispose()
      if (model.mode == 'html') {
        this.dispose = emmetHTML(monaco)
      }
      this.myEditor.setModel(model.model)
      this.bindEvent(model.model)
    },
    // 在 tabs 列表中获得编辑器model
    getActiveModel(name, type) {
      for (var i = 0; i < this.modelList.length; i++) {
        if (type == 'name' && name == this.modelList[i].name) {
          return this.modelList[i] && this.modelList[i]
        }
        if (type == 'title' && name == this.modelList[i].name) {
          return this.modelList[i] && this.modelList[i]
        }
      }
    },
    // 按 name 获得 model
    getModelByName(name) {
      return this.getActiveModel(name, 'name')
    },
    // 按 title 获得 model
    getModelByTitle(title) {
      return this.getActiveModel(title, 'title')
    },
    // 选择 model
    openSelectMode() {
      this.showSelectMode = true
    },
    // 选择完，创建model
    selectModeRadio() {
      this.showSelectMode = false
      this.setModel({
        mode: this.mode,
      })
    },
    // 添加 一个 tab
    addTab(modelContainer) {
      let newTabName =
        this.modelList.length == 1 ? 'tab-1' : 'tab-' + this.modelList.length
      this.modelList.splice(this.modelList.length - 1, 0, modelContainer)
      this.$nextTick(() => {
        this.currentModelName = newTabName.toString()
      })
    },
    // 关闭 一个 tab
    removeTab(targetName) {
      let tabs = this.modelList
      let activeName = this.currentModelName
      if (activeName === targetName) {
        tabs.forEach((tab, index) => {
          if (tab.name === targetName) {
            let nextTab = tabs[index - 1]
            if (nextTab) {
              activeName = nextTab.name
            }
          }
        })
      }
      this.currentModelName = activeName
      let removeModel = this.getModelByName(targetName)
      removeModel.model.dispose()
      this.modelList = tabs.filter((tab) => tab.name !== targetName)
      if (this.modelList.length > 1) {
        let modelContainer = this.modelList[this.modelList.length - 2]
        this.changeEditorModel(modelContainer)
      }
    },
    // 初始化编辑器容器
    initEditor() {
      if (this.settings.mode == 'html') {
        this.dispose = emmetHTML(monaco)
      }
      let that = this
      let ed = document.getElementById('monaco')
      this.myEditor = monaco.editor.create(ed, {
        theme: this.theme,
        automaticLayout: true,
      })

      // this.selection = this.myEditor.getSelection();
      // console.log(this.selection);
    },
    // 增加一个 model
    setModel(source) {
      let newTabName = 'tab-' + this.modelList.length
      let suffix
      switch (source.mode) {
        case 'html':
          suffix = '.html'
          break
        case 'javascript':
          suffix = '.js'
          break
        case 'css':
          suffix = '.css'
          break
      }
      let addMode = Object.assign(source, {
        title: source.name || '新建文件' + suffix,
        name: newTabName,
        closable: true,
      })

      const model = monaco.editor.createModel(source.content || '', source.mode)
      addMode.model = model
      this.changeEditorModel(addMode)
      this.addTab(addMode)
      this.mode = ''
    },
    // 绑定事件
    bindEvent(model) {
      /* eslint-disable */
      let that = this
      model.onDidChangeContent((event) => {
        const newValue = that.myEditor.getValue()
        that.showView(newValue)
      })

      /* eslint-disable */
    },
    setEditorStyle() {
      switch (this.editType) {
        case '1':
          return 'width:50%;'
        case '2':
          return 'width:100%;'
        case '3':
          return 'width:0;'
      }
    },
    setViewStyle() {
      switch (this.editType) {
        case '1':
          return 'width:50%;'
        case '2':
          return 'width:0;'
        case '3':
          return 'width:100%;'
      }
    },
    // 实时运行代码，content 为要修改的内容
    showView(content) {
      if (!this.isRun) {
        return
      }
      try {
        if (!content) {
          content = this.getValue()
        }
        if (!content) {
        }
        let language = this.getModelByName(this.currentModelName).mode
        switch (language) {
          case 'javascript':
            /* eslint-disable */
            content = `<style>*{margin:0;}</style><script>  ${content}  <\/script>`
            /* eslint-disable */
            break
          case 'css':
            return
        }

        // 获得 iframe 对象
        var o = this.$refs.viewIframe

        var ed = document.all ? o.contentWindow.document : o.contentDocument
        let body = ed.body
        body.style.margin = '0px'
        ed.open()
        ed.write(content)
        ed.close()
      } catch (error) {
        toast.tipsError('运行报错')
        console.log('=====================运行报错=======================')
        console.log(error)
      }
    },
    // 获得 编辑器最新内容
    getValue() {
      return this.myEditor.getValue()
    },
  },
  mounted() {
    // 获取缓存的主题设置
    let theme = cache.get('theme')
    this.theme = theme || this.settings.theme

    let isRun = cache.get('isRun')
    this.isRun = isRun == 'true' ? true : false

    this.initEditor()
  },
}
</script>

<style>
@import url('//at.alicdn.com/t/font_2401967_3h51xwp68ox.css');
* {
  margin: 0;
  padding: 0;
  list-style: none;
  text-decoration: none;
}
html,
body {
  width: 100%;
  height: 100vh;
}
#app {
  width: 100%;
  height: 100%;
}
.topTabs {
  height: 41px;
}
.topTabs-dark {
  background: #3c3c3c !important;
  color: #fff !important;
}
.topTabs-dark .el-tabs--card > .el-tabs__header .el-tabs__nav {
  border: 1px solid #666;
}
.topTabs-dark .el-tabs--card > .el-tabs__header {
  border-bottom: 1px solid #666;
}
.topTabs-dark .el-tabs--card > .el-tabs__header .el-tabs__item {
  color: #ccc;
  border-bottom: 1px solid transparent;
  border-left: 1px solid #333;
}
.topTabs-dark .el-tabs--card > .el-tabs__header .el-tabs__item:hover {
  color: #eee;
}
.topTabs-dark .el-tabs--card > .el-tabs__header .el-tabs__item.is-active {
  border-bottom-color: #666;
  color: #fff;
  background: #555;
}
.editorTools {
  height: 40px;
}
.editorTools-dark {
  background: #3c3c3c !important;
  color: #fff !important;
}
.editorTools .toolItem {
  display: inline-block;
  font-size: 18px;
  height: 40px;
  width: 40px;
  line-height: 40px;
  text-align: center;
  cursor: pointer;
  color: #666;
}
.editorTools-dark .toolItem {
  color: #ccc;
}
.toolItemActive {
  background: #ccc;
}
.editorTools-dark .toolItemActive {
  background: #ccc !important;
  color: #252526 !important;
}
.editorTools {
  text-align: left;
}
.editorTools .toolItem:hover {
  background: #eee;
}
.editorTools-dark .toolItem:hover {
  background: #ccc !important;
  color: #252526 !important;
}
.editorToolsFullPage,
.eidtorContentFullPage {
  z-index: 10;
  position: fixed;
  left: 0;
  width: 100%;
  background: #fff;
}
.editorToolsFullPage {
  top: 0;
  height: 41px;
}
.eidtorContentFullPage {
  top: 41px;
  height: calc(100% - 41px) !important;
}
.storageBox .el-button {
  margin-top: 10px;
}
.eidtorContent {
  height: calc(100% - 81px);
}
.monacoEditor {
  overflow: hidden;
  width: 50%;
  height: 100%;
  display: inline-block;
  vertical-align: top;
}
.monaco-editor {
  height: 100%;
}
.viewIframe {
  vertical-align: top;
  width: 50%;
  height: 100%;
  display: inline-block;
  margin: 0;
  border: none;
}
.el-tabs__nav-scroll {
  user-select: none;
}
.selectModelDialog .el-dialog__body div {
  display: flex;
  justify-content: center;
}
.el-tabs__header {
  margin: 0 !important;
}

.rotate {
  /* transition: 0.5s; */
  /* transform-origin: 30px 30px; */
  animation: rotate 1s linear infinite; /*开始动画后无限循环，用来控制rotate*/
}
@keyframes rotate {
  0% {
    transform: rotate(0);
  }
  100% {
    transform: rotate(360deg);
  }
}
</style>

```