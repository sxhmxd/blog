---
title: 登录认证知识
categories: [登录认证知识]
---

## 基于 Cookie/Session 的认证方案

### Cookie 
  由于HTTP 是一种无状态的协议。服务器单从网络连接无法知道客户身份。然后就给客户端们颁发一个通行证，每人一个，无论谁访问都必须携带自己通行证。这样服务器就能从通行证上确认客户身份。
    Cookie 实际上是一小段的文本信息。客户端请求服务器，如果服务器需要记录该用户状态，就使用 response 向客户浏览器颁发一个 Cookie。客户端浏览器会把 Cookie 保存起来。当浏览器再请求该网站时，浏览器把请求的网址连同该Cookie 一同提交给服务器。服务器检查该 Cookie,以此来辨认用户状态。
  
####  Cookie的不可跨域名性
  Cookie 具有不可跨域名性，根据Cookie的规范，浏览器访问 Google只会携带 Goole的 Cookie,而不会携带 Baidu 的Cookie

### Session 
  Session 是另一种记录客户端状态的机制，不同的是 Cookie 保存在客户端浏览器中，而Session 保存在服务器上。客户端访问服务器的时候，服务器把客户端信息以某种形式记录在服务器上。客户端再次访问的时候只需要从该 Session 中查找该客户的状态就可以了。

`Cookie 机制是通过检查客户身上的  通行证 来确定客户身份，那么 Session 机制就是通过检查服务器上的  客户明细表 来确认客户身份。 `

  Session 服务器给每个客户端分配不同的 `身份标识`，然后 `客户端` 每次向服务器发送请求的时候，都带上这个`身份标识`，服务器就知道这个请求是来自于谁。

- 优缺点
  服务器用 Session 把用户信息临时保存在了服务器上，用户离开网站后session 会被销毁，这种用户信息存储方式相对 cookie来说更安全。
  缺陷：如果服务器做了负载均衡，那么下一个操作请求到了另一台服务器的时候 session 就会丢失。
Session 的使用比Cookie 方便，但是过多的 Session 存储在服务器内存中，会对服务器造成压力。

#### Cookie 与 Session 的区别和联系
  - cookie 数据保存在客户端的浏览器上，session 数据放在服务器上；
  - cookie 不是很安全，别人可以分析存放在本地的 Cookie 并进行Cookie欺骗，考虑安全应当使用 session.
  - session 会在一定时间内保存在服务器上。当访问增多，会比较占用服务器的性能。考虑到减轻服务器性能方面，应当使用Cookie
  - Cookie 存储大小为 3K，存放在客户端的Cookie 不能超过 3K.

Cookie 和 Session 的方案虽然分别属于客户端和服务端，但是服务端的 session 的实现对客户端的 Cookie 的依赖关系的，服务端执行 session机制时候会生成session的id，这个id 值会发送给客户端，客户端每次请求都会把这个 id 值放到 http 请求的头部发送给服务端，而这个 id 值在客户端会保存下来，保存的容器就是 Cookie 。因此当我们完全禁掉浏览器 Cookie的时候，服务端的session 也不能正常使用。


## 基于 Token 的认证方式

 原理：基于Token的身份验证是`无状态` ，我们不将信息存储在服务器中。

### 基于Token的身份验证的过程如下：
  - 用户通过用户名和密码发送请求
  - 服务器端程序验证。
  - 服务器端程序返回一个 带签名的 token 给客户端。
  - 客户端存储token，并且每次访问 API 都携带 Token 到服务器端
  - 服务端验证 token，校验成功则返回请求数据，校验失败则返回错误码。
  ![token登录流程](https://images2018.cnblogs.com/blog/1350514/201805/1350514-20180504123850641-479661599.png)

#### Token 的优势

  - 无状态、可扩展
    客户端存储的Token是无状态的，并且是能够被扩展。
  - 安全性
    请求中发送 token 而不再是发送 cookie 能够防止 CSRF(跨战情求伪造)。即使在客户端使用 Cookie 存储 token , cookie也仅仅是一个存储机制而不是拥有认证。不将信息存储在Session 中，让我们减少了对 Session 操作。
      token 是有时效性的，一段时间之后用户需要重新验证。
  - 可扩展性
    Token 能够创建与其他程序共享权限的程序。
  - 多平台跨域
